<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8" />
  <title>Hydro-Collider in Action</title>
  <style>
    body{
      margin-top: 30px;
      margin-left:40px;
    }
  </style>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="http://code.highcharts.com/highcharts.js"></script>
  <script type="text/javascript">
    $(function () {
      var currentTime = new Date();
      var tzOffset = currentTime.getTimezoneOffset();

      var array_temperature = [];
      var array_water_temperature = [];
      var array_humidity = [];
      var array_volume = [];
      var array_ppm = [];
      var array_pump = [];

      var delta = 0.5;

      Highcharts.setOptions({
        global: {
          timezoneOffset: tzOffset
        }
      });

      $.getJSON('/lastPumpActions', function(data) {
        for (i = data.length - 1; i >= 0; i--){
          var pump_value;
          if (data[i].a == 'ENABLED') {
            pump_value = 1;
          } else {
            pump_value = 0;
          }
          array_pump.push([data[i].t, pump_value]);
        }

        $('#container_pump').highcharts({
          chart: {
            zoomType: 'x'
          },
          title: {
            text: "Pump Actions"
          },
          xAxis: {
            type: 'datetime',
            pointInterval: 1000 * 60 * 60,
            max: currentTime.getTime()
          },
          yAxis: {
            title: {
              text: "Status"
            }
          },
          series: [{
            type: 'area',
            name: 'Pump',
            color: '#9a9a9a',
            data: array_pump,
            step: 'left'
          }]
        });

      });

      $.getJSON('/lastReports', function(data) {
        for (i = data.length - 1; i >= 0; i--){
          array_temperature.push([data[i].d, data[i].t]);
          array_water_temperature.push([data[i].d, data[i].w]);
          array_humidity.push([data[i].d, data[i].h]);
          array_volume.push([data[i].d, data[i].v]);
          array_ppm.push([data[i].d, data[i].p]);
        }

        $('#container_temperature').highcharts({
          chart: {
            zoomType: 'x'
          },
          title: {
            text: "Temperature"
          },
          xAxis: {
            type: 'datetime',
            pointInterval: 1000 * 60 * 60,
            max: currentTime.getTime()
          },
          yAxis: {
            title: {
              text: "&#8451;"
            },
            min: Math.min(Math.floor(Math.min.apply(Math, array_water_temperature.map(function(o){return o[1];})) - delta), Math.floor(Math.min.apply(Math, array_temperature.map(function(o){return o[1];})) - delta)),
            max: Math.max(Math.ceil(Math.max.apply(Math, array_water_temperature.map(function(o){return o[1];})) + delta), Math.ceil(Math.max.apply(Math, array_temperature.map(function(o){return o[1];})) + delta))
          },
          series: [
            {
              type: 'area',
              name: 'Air Temperature',
              color: '#bf4000',
              data: array_temperature
            },
            {
              type: 'area',
              name: 'Water Temperature',
              color: '#206fbf',
              data: array_water_temperature
            }]
        });

        $('#container_humidity').highcharts({
          chart: {
            zoomType: 'x'
          },
          title: {
            text: "Humidity"
          },
          xAxis: {
            type: 'datetime',
            pointInterval: 1000 * 60 * 60,
            max: currentTime.getTime()
          },
          yAxis: {
            title: {
              text: "%"
            },
            min: Math.floor(Math.min.apply(Math, array_humidity.map(function(o){return o[1];})) - delta),
            max: Math.ceil(Math.max.apply(Math, array_humidity.map(function(o){return o[1];})) + delta)
          },
          series: [{
            type: 'area',
            name: 'Humidity',
            color: '#00a6bf',
            data: array_humidity
          }]
        });

        $('#container_volume').highcharts({
          chart: {
            zoomType: 'x'
          },
          title: {
            text: "Volume"
          },
          xAxis: {
            type: 'datetime',
            pointInterval: 1000 * 60 * 60,
            max: currentTime.getTime()
          },
          yAxis: {
            title: {
              text: "L"
            },
            min: Math.floor(Math.min.apply(Math, array_volume.map(function(o){return o[1];})) - delta),
            max: Math.ceil(Math.max.apply(Math, array_volume.map(function(o){return o[1];})) + delta)
          },
          series: [{
            type: 'area',
            name: 'Volume',
            color: '#20bf00',
            data: array_volume
          }]
        });

        $('#container_ppm').highcharts({
          chart: {
            zoomType: 'x'
          },
          title: {
            text: "PPM"
          },
          xAxis: {
            type: 'datetime',
            pointInterval: 1000 * 60 * 60,
            max: currentTime.getTime()
          },
          yAxis: {
            title: {
              text: "PPM"
            },
            min: Math.floor(Math.min.apply(Math, array_ppm.map(function(o){return o[1];})) - delta),
            max: Math.ceil(Math.max.apply(Math, array_ppm.map(function(o){return o[1];})) + delta)
          },
          series: [{
            type: 'area',
            name: 'PPM',
            color: '#bbbf00',
            data: array_ppm
          }]
        });
      });
    });
  </script>
</head>
<body>
<div id="container_temperature" style="height: 300px; width: 50%; float: left;"></div><div id="container_humidity" style="height: 300px; width: 50%; float: left;"></div>
<div id="container_volume" style="height: 300px; width: 50%; float: left;"></div><div id="container_ppm" style="height: 300px; width: 50%; float: left;"></div>
<div id="container_pump" style="height: 300px; width: 100%; float: left;"></div>

</body>
</html>